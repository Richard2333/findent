#!/bin/bash
# $Id: maketar 176 2016-12-23 07:31:52Z willem_vermin $
curdir=`pwd`                                       || exit 1
./bootstrap                                        || exit 1
./configure                                        || exit 1
make maintainer-clean                              || exit 1
rm -rf bin share
./bootstrap                                        || exit 1
export CXX='g++ -m32 -static'                      || exit 1
./configure --prefix=$PWD                          || exit 1
make clean                                         || exit 1
make install-strip                                 || exit 1
make check                                         || exit 1
#unset CXX                                          || exit 1
#./configure --with-windows --prefix=$PWD           || exit 1
#make clean                                         || exit 1
#make install-strip                                 || exit 1
version=`./getversion`                             || exit 1
echo "version = $version"
if [ -e debian/changelog] ; then
   sed -i "1s/(.*)/($version)/" debian/changelog   || exit 1
fi
#echo 'running svn commit ...'
#svn commit -m 'adapted debian/changelog' \
#              debian/changelog
make distclean                                     || exit 1
if [ -d debian ] ; then
   dh clean                                           || exit 1
fi
cd ..                                              || exit 1
mkdir -p versions                                  || exit 1
cp $curdir/README.1st versions/README              || exit 1
cd versions                                        || exit 1
unix2dos README                                    || exit 1
rm -rf "findent-$version"
cp -r $curdir "findent-$version"                   || exit 1
rm -r findent-$version/debian
rm -r findent-$version/makedeb
tar zcf "findent-$version.tar.gz" \
        "findent-$version"                         || exit 1
rm -rf "findent-$version"                          || exit 1
cd "$curdir"                                       || exit 1
./configure                                        || exit 1
make maintainer-clean                              || exit 1
echo "$0 done"
